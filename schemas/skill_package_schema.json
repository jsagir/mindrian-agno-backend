{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Mindrian Skill Package",
  "description": "Schema for transforming Claude Desktop projects into Mindrian skill packages",
  "version": "1.0.0",

  "type": "object",
  "required": ["metadata", "agents", "outputs"],

  "properties": {

    "metadata": {
      "type": "object",
      "description": "Skill package metadata",
      "required": ["id", "name", "version", "description"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique skill identifier (lowercase, hyphens allowed)",
          "examples": ["minto-pyramid", "reverse-salient-discovery", "jtbd-mapping"]
        },
        "name": {
          "type": "string",
          "description": "Human-readable skill name",
          "examples": ["Minto Pyramid Analysis", "Reverse Salient Discovery"]
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version",
          "examples": ["1.0.0", "2.1.3"]
        },
        "description": {
          "type": "string",
          "description": "Brief description of what the skill does"
        },
        "author": {
          "type": "string",
          "description": "Skill author or organization"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Categorization tags",
          "examples": [["strategy", "analysis", "innovation"]]
        },
        "icon": {
          "type": "string",
          "description": "Icon name (lucide icons)",
          "examples": ["pyramid", "target", "brain", "search"]
        },
        "category": {
          "type": "string",
          "enum": ["framework", "analysis", "discovery", "validation", "extraction", "synthesis"],
          "description": "Primary skill category"
        }
      }
    },

    "source": {
      "type": "object",
      "description": "Original source information (for migration tracking)",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["claude-desktop-extension", "fastmcp-cloud", "mcp-server", "custom"],
          "description": "Where this skill originated"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Original source URL if applicable"
        },
        "extension_id": {
          "type": "string",
          "description": "Claude Desktop extension ID if migrated from there"
        },
        "mcp_config": {
          "type": "object",
          "description": "Original MCP server configuration",
          "properties": {
            "command": { "type": "string" },
            "args": { "type": "array", "items": { "type": "string" } },
            "env": { "type": "object" }
          }
        }
      }
    },

    "agents": {
      "type": "array",
      "description": "Agents that implement this skill",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "role", "instructions"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$",
            "description": "Unique agent identifier"
          },
          "name": {
            "type": "string",
            "description": "Display name for the agent"
          },
          "role": {
            "type": "string",
            "enum": ["primary", "specialist", "validator", "synthesizer", "critic"],
            "description": "Agent's role in the skill workflow"
          },
          "description": {
            "type": "string",
            "description": "Brief description of agent's purpose"
          },
          "model": {
            "type": "object",
            "description": "LLM model configuration",
            "properties": {
              "provider": {
                "type": "string",
                "enum": ["google", "anthropic", "openai"],
                "default": "google"
              },
              "model_id": {
                "type": "string",
                "default": "gemini-2.5-flash-preview-05-20"
              },
              "temperature": {
                "type": "number",
                "minimum": 0,
                "maximum": 2,
                "default": 0.7
              },
              "max_tokens": {
                "type": "integer",
                "default": 4096
              }
            }
          },
          "instructions": {
            "type": "string",
            "description": "Full system prompt for the agent (markdown supported)"
          },
          "tools": {
            "type": "array",
            "description": "Tools this agent can use",
            "items": {
              "type": "string",
              "description": "Tool ID reference"
            }
          },
          "handoff_triggers": {
            "type": "array",
            "description": "Conditions that trigger handoff to another agent",
            "items": {
              "type": "object",
              "required": ["condition", "target_agent"],
              "properties": {
                "condition": {
                  "type": "string",
                  "description": "Natural language condition for handoff",
                  "examples": [
                    "When SCQA framework is complete",
                    "When user requests validation",
                    "After 5 clarifying questions"
                  ]
                },
                "target_agent": {
                  "type": "string",
                  "description": "ID of agent to hand off to"
                },
                "context_to_pass": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "State keys to pass to target agent",
                  "examples": [["scqa_output", "user_context", "session_id"]]
                },
                "message": {
                  "type": "string",
                  "description": "Message to include in handoff"
                }
              }
            }
          },
          "reasoning": {
            "type": "boolean",
            "default": true,
            "description": "Enable thinking/reasoning display"
          }
        }
      }
    },

    "team": {
      "type": "object",
      "description": "Team configuration if agents work together",
      "properties": {
        "name": {
          "type": "string",
          "description": "Team display name"
        },
        "mode": {
          "type": "string",
          "enum": ["coordinate", "collaborate", "route", "sequential"],
          "description": "How agents work together",
          "default": "coordinate"
        },
        "leader": {
          "type": "string",
          "description": "ID of the lead agent (for coordinate mode)"
        },
        "member_order": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Order of agents for sequential mode"
        },
        "success_criteria": {
          "type": "string",
          "description": "Condition for team task completion"
        }
      }
    },

    "tools": {
      "type": "array",
      "description": "Custom tools for this skill",
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "implementation"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Tool identifier (snake_case)"
          },
          "name": {
            "type": "string",
            "description": "Human-readable tool name"
          },
          "description": {
            "type": "string",
            "description": "What the tool does (shown to LLM)"
          },
          "parameters": {
            "type": "object",
            "description": "JSON Schema for tool parameters",
            "properties": {
              "type": { "const": "object" },
              "properties": { "type": "object" },
              "required": { "type": "array", "items": { "type": "string" } }
            }
          },
          "implementation": {
            "type": "object",
            "description": "How the tool is implemented",
            "oneOf": [
              {
                "properties": {
                  "type": { "const": "python" },
                  "code": { "type": "string", "description": "Python function code" },
                  "dependencies": { "type": "array", "items": { "type": "string" } }
                },
                "required": ["type", "code"]
              },
              {
                "properties": {
                  "type": { "const": "mcp" },
                  "server": { "type": "string", "description": "MCP server name" },
                  "tool_name": { "type": "string", "description": "Tool name on MCP server" }
                },
                "required": ["type", "server", "tool_name"]
              },
              {
                "properties": {
                  "type": { "const": "http" },
                  "url": { "type": "string", "format": "uri" },
                  "method": { "type": "string", "enum": ["GET", "POST", "PUT", "DELETE"] },
                  "headers": { "type": "object" }
                },
                "required": ["type", "url", "method"]
              },
              {
                "properties": {
                  "type": { "const": "fastmcp" },
                  "server_url": { "type": "string", "format": "uri" },
                  "tool_name": { "type": "string" }
                },
                "required": ["type", "server_url", "tool_name"]
              }
            ]
          },
          "returns": {
            "type": "object",
            "description": "Description of return value",
            "properties": {
              "type": { "type": "string" },
              "description": { "type": "string" }
            }
          }
        }
      }
    },

    "mcp_servers": {
      "type": "array",
      "description": "MCP servers this skill depends on",
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Server identifier"
          },
          "name": {
            "type": "string",
            "description": "Display name"
          },
          "description": {
            "type": "string"
          },
          "config": {
            "type": "object",
            "properties": {
              "command": { "type": "string" },
              "args": { "type": "array", "items": { "type": "string" } },
              "env": {
                "type": "object",
                "additionalProperties": {
                  "oneOf": [
                    { "type": "string" },
                    {
                      "type": "object",
                      "properties": {
                        "env_var": { "type": "string", "description": "Environment variable name" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "tools_used": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Which tools from this server are used"
          }
        }
      }
    },

    "workflow": {
      "type": "object",
      "description": "Multi-stage workflow definition",
      "properties": {
        "stages": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "name", "agent"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Stage identifier"
              },
              "name": {
                "type": "string",
                "description": "Stage display name"
              },
              "description": {
                "type": "string"
              },
              "agent": {
                "type": "string",
                "description": "Agent ID that handles this stage"
              },
              "input": {
                "type": "object",
                "description": "Expected input for this stage",
                "properties": {
                  "from_stage": { "type": "string" },
                  "fields": { "type": "array", "items": { "type": "string" } }
                }
              },
              "output": {
                "type": "object",
                "description": "Output produced by this stage",
                "properties": {
                  "format": { "type": "string" },
                  "fields": { "type": "array", "items": { "type": "string" } }
                }
              },
              "validation": {
                "type": "object",
                "description": "Validation rules for stage output",
                "properties": {
                  "required_fields": { "type": "array", "items": { "type": "string" } },
                  "quality_checks": { "type": "array", "items": { "type": "string" } }
                }
              },
              "on_success": {
                "type": "string",
                "description": "Next stage ID on success"
              },
              "on_failure": {
                "type": "string",
                "description": "Stage ID to go to on failure (for retry/revision)"
              }
            }
          }
        },
        "entry_point": {
          "type": "string",
          "description": "ID of first stage"
        },
        "exit_point": {
          "type": "string",
          "description": "ID of final stage"
        }
      }
    },

    "outputs": {
      "type": "object",
      "description": "Structured output definitions",
      "required": ["primary"],
      "properties": {
        "primary": {
          "type": "object",
          "description": "Main deliverable of the skill",
          "required": ["name", "format", "schema"],
          "properties": {
            "name": {
              "type": "string",
              "examples": ["Minto Pyramid", "JTBD Map", "Validation Scorecard"]
            },
            "description": {
              "type": "string"
            },
            "format": {
              "type": "string",
              "enum": ["markdown", "json", "html", "structured"],
              "default": "markdown"
            },
            "schema": {
              "type": "object",
              "description": "JSON Schema for structured output",
              "properties": {
                "type": { "type": "string" },
                "properties": { "type": "object" },
                "required": { "type": "array" }
              }
            },
            "template": {
              "type": "string",
              "description": "Markdown template for output rendering"
            }
          }
        },
        "secondary": {
          "type": "array",
          "description": "Additional outputs produced",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "format": { "type": "string" },
              "schema": { "type": "object" }
            }
          }
        },
        "artifacts": {
          "type": "array",
          "description": "Files or data artifacts produced",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "type": { "type": "string", "enum": ["file", "image", "data", "report"] },
              "format": { "type": "string" }
            }
          }
        }
      }
    },

    "state": {
      "type": "object",
      "description": "Session state management",
      "properties": {
        "session_vars": {
          "type": "array",
          "description": "Variables tracked across the session",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "type": { "type": "string" },
              "description": { "type": "string" },
              "default": {}
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["sqlite", "neo4j", "memory"],
              "default": "sqlite"
            },
            "table": { "type": "string" }
          }
        }
      }
    },

    "knowledge": {
      "type": "object",
      "description": "Knowledge base / RAG configuration",
      "properties": {
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["pinecone", "neo4j", "supabase", "file"]
              },
              "config": {
                "type": "object",
                "description": "Source-specific configuration"
              },
              "query_tool": {
                "type": "string",
                "description": "Tool ID for querying this source"
              }
            }
          }
        },
        "auto_retrieve": {
          "type": "boolean",
          "default": false,
          "description": "Automatically retrieve relevant knowledge"
        }
      }
    },

    "examples": {
      "type": "array",
      "description": "Example inputs and outputs for testing/demo",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "input": { "type": "string" },
          "expected_output": { "type": "object" }
        }
      }
    },

    "dependencies": {
      "type": "object",
      "description": "External dependencies",
      "properties": {
        "python": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Python packages required"
        },
        "npm": {
          "type": "array",
          "items": { "type": "string" },
          "description": "NPM packages required"
        },
        "env_vars": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "description": { "type": "string" },
              "required": { "type": "boolean" }
            }
          }
        }
      }
    }
  }
}
